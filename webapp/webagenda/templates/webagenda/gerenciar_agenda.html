{% extends "base.html" %}

{% block content %}
    
    <div class="col-sm-12 col-md-10 col-lg-8 col-xl-6 mx-auto mt-5">
        <h2 class="text-center mb-4">{% if agenda %}Editar Agenda{% else %}Criar Agenda{% endif %}</h2>
        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="titulo">Título</label>
                <input type="text" class="form-control" id="titulo" name="titulo" value="{{ agenda.titulo }}" required>
            </div>
            
            <div class="form-group mt-3">
                <label for="descricao">Descrição</label>
                <textarea class="form-control mt-1" id="descricao" name="descricao" required>{{ agenda.descricao }}</textarea>
            </div>
            
            <div class="form-group mt-3">
                <label for="dataInicio">Data de Início</label>
                <input type="datetime-local" class="form-control mt-1" id="dataInicio" name="dataInicio" value="{{ agenda.dataInicio|default:'' }}" required step="900">
            </div>
            
            <div class="form-group mt-3">
                <label for="dataFim">Data de Fim</label>
                <input type="datetime-local" class="form-control mt-1" id="dataFim" name="dataFim" value="{{ agenda.dataFim|default:'' }}" required step="900">
            </div>
            
            <div class="form-group mt-3">
                <label for="local">Local</label>
                <input type="text" class="form-control mt-1" id="local" name="local" value="{{ agenda.local }}" required>
            </div>
            
            <div class="form-group mt-3">
                <label for="estado_atual">Estado Atual</label>
                <select class="form-control mt-1" id="estado_atual" name="estado_atual">
                    <option value="RECEBIDO" {% if agenda and agenda.estado_atual == "RECEBIDO" %}selected{% endif %}>Recebido</option>
                    <option value="CONFIRMADO" {% if agenda and agenda.estado_atual == "CONFIRMADO" %}selected{% endif %}>Confirmado</option>
                    <option value="ATENDIDO" {% if agenda and agenda.estado_atual == "ATENDIDO" %}selected{% endif %}>Atendido</option>
                    <option value="CANCELADO" {% if agenda and agenda.estado_atual == "CANCELADO" %}selected{% endif %}>Cancelado</option>
                </select>
            </div>
            
            <div class="d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary">{% if agenda %}Salvar{% else %}Criar{% endif %}</button>
                {% if agenda %}
                    <button type="button" class="btn btn-danger ms-2" onclick="removerAgenda({{ agenda.id }})">Remover</button>
                {% endif %}
            </div>
        </form>
    </div>
    
{% endblock %}

{% block scripts %}
<script>
    function removerAgenda(id) {
        if (confirm("Tem certeza que deseja remover esta agenda?")) {
            fetch(`/webagenda/deletar/${id}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = "{% url 'listar_agendas' %}";
                } else {
                    alert("Falha ao remover a agenda.");
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert("Falha ao remover a agenda.");
            });
        }
    }
</script>
{% endblock %}
